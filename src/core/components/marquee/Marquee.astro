---
import { getComponentConfig } from "@/core/bootstrap/store";
import { getCurrentLang } from "@/core/i18n";
import type { MarqueeProps } from "./marquee.props";
import MarqueeRenderer from "./MarqueeRenderer.astro";

// Props 定义保持不变 (作为类型参考和覆盖来源)
const { instanceId, forceRender, ...propsFromCaller } = Astro.props;

// 1. 确定语言
const currentLang = getCurrentLang(Astro.url);

// 2. 从 Store 获取完整配置 (包含 逻辑参数 和 文本内容)
// 这已经合并了：System Default -> User Locale Default -> User Locale Instance
const storeConfig = getComponentConfig<MarqueeProps>(
  "marquee",
  currentLang,
  instanceId
);

// 3. 最终合并 (Props 传参优先级最高)
const finalProps: MarqueeProps = {
  ...storeConfig,
  ...propsFromCaller,
};

// 4. 渲染检查
// 如果 storeConfig 为空且没传 props，说明用户既没配置也没默认值，finalProps 可能不完整
// 依靠 MarqueeRenderer 的默认值兜底，或者在这里 check enable
const shouldRender = finalProps.enable !== false; // 默认为 true

// DEBUG
// console.log('[Marquee Debug] Config:', JSON.stringify(storeConfig, null, 2));
---

{shouldRender && <MarqueeRenderer {...finalProps} />}
